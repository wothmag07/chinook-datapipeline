version: 2

models:
  - name: int_customer_orders
    description: "Aggregated order metrics at customer grain: lifetime value and order count."
    columns:
      - name: customer_id
        description: "Customer identifier (grain column)."
        tests:
          - not_null
          - unique
      - name: customer_lifetime_value
        description: "Total revenue generated from the customer across all orders."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: order_count
        description: "Total number of distinct orders placed by the customer."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: first_order_date
        description: "Date of the customer's first order."
        tests: [not_null]
      - name: last_order_date
        description: "Date of the customer's most recent order."
        tests: [not_null]

  - name: int_track_sales
    description: "Aggregated sales metrics at track grain: units sold, revenue, order count, and date range."
    columns:
      - name: track_id
        description: "Track identifier (grain column)."
        tests:
          - not_null
          - unique
      - name: track_name
        description: "Name of the track."
        tests: [not_null]
      - name: album_id
        description: "Album the track belongs to."
        tests: [not_null]
      - name: media_type_id
        description: "Media type of the track."
        tests: [not_null]
      - name: genre_id
        description: "Genre of the track."
        tests: [not_null]
      - name: units_sold
        description: "Total units of the track sold."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue
        description: "Total revenue generated from the track."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: first_sold_date
        description: "Date the track was first sold."
        tests: [not_null]
      - name: last_sold_date
        description: "Date the track was last sold."
        tests: [not_null]
      - name: order_count
        description: "Number of distinct invoices that included this track."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_employee_sales
    description: "Sales performance metrics per employee (support rep)."
    columns:
      - name: employee_id
        description: "Employee identifier (grain column)."
        tests:
          - not_null
          - unique
      - name: first_name
        description: "First name of the employee."
        tests: [not_null]
      - name: last_name
        description: "Last name of the employee."
        tests: [not_null]
      - name: title
        description: "Job title of the employee."
      - name: revenue
        description: "Total revenue attributed to customers supported by this employee."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: invoices_handled
        description: "Number of distinct invoices for customers supported by this employee."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: lines_handled
        description: "Total invoice line items for customers supported by this employee."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_album_sales
    description: "Aggregated sales per album: total units sold and revenue."
    columns:
      - name: album_id
        description: "Album identifier (grain column)."
        tests:
          - not_null
          - unique
      - name: units_sold
        description: "Total units sold for the album."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue
        description: "Total revenue generated from the album."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_genre_sales
    description: "Aggregated sales per genre: total units sold and revenue."
    columns:
      - name: genre_id
        description: "Genre identifier (grain column)."
        tests:
          - not_null
          - unique
      - name: units_sold
        description: "Total units sold for the genre."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue
        description: "Total revenue generated from the genre."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: int_media_sales
    description: "Aggregated sales per media type: total units sold and revenue."
    columns:
      - name: media_type_id
        description: "Media type identifier (grain column)."
        tests:
          - not_null
          - unique
      - name: units_sold
        description: "Total units sold for the media type."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue
        description: "Total revenue generated from the media type."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
